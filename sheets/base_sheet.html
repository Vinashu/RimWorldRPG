<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive character sheet for RimWorld RPG - Base/Colony Management">
    <title>RimWorld RPG - Base/Colony Sheet</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/data-loader.js"></script>
    <script src="js/base_sheet.js"></script>
</head>

<body>
    <div class="container">
        <!-- Overview -->
        <header class="panel header-section">
            <div style="flex-grow: 1;">
                <label for="colony-name">Colony Name</label>
                <input type="text" id="colony-name" name="colony-name" placeholder="Hope's End" value="Hope's End"
                    style="font-size: 1.5em; font-weight: bold;" aria-label="Colony Name">
            </div>
            <div style="width: 200px;">
                <label for="biome">Biome</label>
                <input type="text" id="biome" name="biome" value="Arid Shrubland" aria-label="Biome Type">
            </div>
            <div style="width: 150px;">
                <label for="tech-level-display">Tech Level</label>
                <input type="text" id="tech-level-display" name="tech-level" value="Industrial"
                    aria-label="Current Technology Level">
            </div>
        </header>

        <!-- Base Stats -->
        <section class="panel" style="grid-column: span 12;" aria-labelledby="colony-stats-heading">
            <h2 id="colony-stats-heading">Colony Stats</h2>
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <div class="vital-box" style="border-color: var(--danger);">
                    <label for="security-value">SECURITY</label>
                    <div class="vital-value" id="security-value" aria-label="Security Rating">8</div>
                </div>
                <div class="vital-box" style="border-color: var(--success);">
                    <label for="efficiency-value">EFFICIENCY</label>
                    <div class="vital-value" id="efficiency-value" aria-label="Efficiency Bonus">+1</div>
                </div>
                <div class="vital-box" style="border-color: var(--accent-color);">
                    <label for="comfort-value">COMFORT</label>
                    <div class="vital-value" id="comfort-value" aria-label="Comfort Bonus">+2</div>
                </div>
                <div class="vital-box" style="border-color: var(--warning);">
                    <label for="total-wealth-score">WEALTH SCORE</label>
                    <div class="vital-value" id="total-wealth-score" aria-live="polite" aria-label="Total Wealth Score">
                        57</div>
                    <span style="font-size: 0.7em; color: #888;" id="wealth-tier-quick">Prosperous</span>
                </div>
            </div>
        </section>

        <!-- Wealth Score Calculator -->
        <section class="panel" style="grid-column: span 12;" aria-labelledby="wealth-calculator-heading">
            <h2 id="wealth-calculator-heading">Wealth Score Calculator</h2>
            <form id="wealth-calculator-form" aria-label="Wealth Score Calculator">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <!-- Tech Points -->
                    <fieldset style="border: 1px solid #444; padding: 10px; border-radius: 5px;">
                        <legend style="margin-top: 0; color: var(--accent-color); font-weight: bold;">Tech Points
                        </legend>
                        <label for="tech-neo">Neolithic (1pt/lvl):</label>
                        <input type="number" id="tech-neo" name="tech-neo" value="0" min="0" max="4"
                            aria-label="Neolithic Tech Levels" title="0-4 levels">
                        <label for="tech-med">Medieval (2pts/lvl):</label>
                        <input type="number" id="tech-med" name="tech-med" value="0" min="0" max="5"
                            aria-label="Medieval Tech Levels" title="0-5 levels">
                        <label for="tech-ind">Industrial (4pts/lvl):</label>
                        <input type="number" id="tech-ind" name="tech-ind" value="2" min="0" max="6"
                            aria-label="Industrial Tech Levels" title="0-6 levels">
                        <label for="tech-spacer">Spacer (8pts/lvl):</label>
                        <input type="number" id="tech-spacer" name="tech-spacer" value="0" min="0" max="7"
                            aria-label="Spacer Tech Levels" title="0-7 levels">
                        <div style="margin-top: 10px; font-weight: bold;" aria-live="polite">
                            Subtotal: <span id="tech-total">8</span> pts
                        </div>
                    </fieldset>

                    <!-- Building Points (AUTO-CALCULATED) -->
                    <fieldset style="border: 1px solid #444; padding: 10px; border-radius: 5px;">
                        <legend style="margin-top: 0; color: var(--success); font-weight: bold;">Building Points
                            <span style="font-size: 0.8em; color: var(--accent-color); font-weight: normal;">
                                (Auto-Calculated)</span>
                        </legend>
                        <div
                            style="padding: 10px; background: rgba(0,150,0,0.1); border-radius: 4px; text-align: center;">
                            <div style="font-size: 1.3em; font-weight: bold; color: var(--success);">
                                <span id="building-count">0</span> facilities = <span id="build-total">0</span> pts
                            </div>
                            <div style="font-size: 0.85em; color: #aaa; margin-top: 5px;">
                                Add facilities using the Facility Builder below
                            </div>
                        </div>
                    </fieldset>

                    <!-- Defense Points (AUTO-CALCULATED) -->
                    <fieldset style="border: 1px solid #444; padding: 10px; border-radius: 5px;">
                        <legend style="margin-top: 0; color: var(--warning); font-weight: bold;">Defense Points
                            <span style="font-size: 0.8em; color: var(--accent-color); font-weight: normal;">
                                (Auto-Calculated)</span>
                        </legend>
                        <div
                            style="padding: 10px; background: rgba(200,150,0,0.1); border-radius: 4px; text-align: center;">
                            <div style="font-size: 1.3em; font-weight: bold; color: var(--warning);">
                                <span id="defense-count">0</span> defenses = <span id="def-total">0</span> pts
                            </div>
                            <div style="font-size: 0.85em; color: #aaa; margin-top: 5px;">
                                Add defenses using the Defense Builder below
                            </div>
                        </div>
                    </fieldset>

                    <!-- Colonist Points -->
                    <fieldset style="border: 1px solid #444; padding: 10px; border-radius: 5px;">
                        <legend style="margin-top: 0; color: var(--warning); font-weight: bold;">Colonist Points
                        </legend>
                        <label for="col-pcs">Player Characters (10pts):</label>
                        <input type="number" id="col-pcs" name="col-pcs" value="3" min="0"
                            aria-label="Number of Player Characters">
                        <label for="col-recruits">Recruits (5pts):</label>
                        <input type="number" id="col-recruits" name="col-recruits" value="0" min="0" max="4"
                            aria-label="Number of Recruits" title="Maximum 4 recruits">
                        <div style="margin-top: 10px; font-weight: bold;" aria-live="polite">
                            Subtotal: <span id="col-total">30</span> pts
                        </div>
                    </fieldset>
                </div>

                <!-- Total and Tier Display -->
                <div style="margin-top: 20px; padding: 15px; background: rgba(100,100,100,0.2); border-radius: 5px; text-align: center;"
                    role="status" aria-live="polite">
                    <div style="font-size: 1.5em; font-weight: bold;">
                        Total Wealth Score: <span id="wealth-score-display" style="color: var(--warning);">57</span>
                    </div>
                    <div style="font-size: 1.2em; margin-top: 5px;">
                        Colony Tier: <span id="colony-tier" style="color: var(--accent-color);">Prosperous</span>
                    </div>
                    <div style="margin-top: 5px; color: #aaa;">
                        Max Recruits: <span id="max-recruits">3</span> | Raid Points: <span id="raid-points">57</span>
                    </div>
                </div>
            </form>
        </section>

        <!-- Facility Builder -->
        <section class="panel" id="facility-builder" style="margin-top: 20px;">
            <h2>Facility Builder</h2>
            <p style="color: #aaa; font-size: 0.9em;">Select facilities to add to your colony</p>

            <div style="margin-bottom: 15px;">
                <label for="facility-select">Add Facility:</label>
                <select id="facility-select" style="margin-bottom: 10px;">
                    <option value="">-- Select Facility --</option>
                </select>
                <button onclick="addFacility()"
                    style="padding: 8px 16px; background: var(--success); border: none; border-radius: 4px; cursor: pointer;">Add
                    to Colony</button>
            </div>

            <div id="facility-list" style="display: grid; gap: 10px;">
                <!-- Facilities will be added here dynamically -->
            </div>
        </section>

        <!-- Defense Builder -->
        <section class="panel" id="defense-builder" style="margin-top: 20px;">
            <h2>Defense Builder</h2>
            <p style="color: #aaa; font-size: 0.9em;">Build defensive structures for your colony</p>

            <div style="margin-bottom: 15px;">
                <label for="defense-select">Add Defense:</label>
                <select id="defense-select" style="margin-bottom: 10px;">
                    <option value="">-- Select Defense --</option>
                </select>
                <button onclick="addDefense()"
                    style="padding: 8px 16px; background: var(--warning); border: none; border-radius: 4px; cursor: pointer;">Add
                    Defense</button>
            </div>

            <div id="defense-list" style="display: grid; gap: 10px;">
                <!-- Defenses will be added here dynamically -->
            </div>
        </section>

        <!-- Tech Tree Display -->
        <section class="panel" id="tech-tree" style="margin-top: 20px;">
            <h2>Technology Tree</h2>
            <p style="color: #aaa; font-size: 0.9em;">Current research progress and available technologies</p>

            <div id="tech-categories"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <!-- Tech categories will be populated from JSON -->
            </div>
        </section>

        <!-- Defense Pool (AUTO-CALCULATED) -->
        <section class="panel defense-pool" aria-labelledby="defense-pool-heading">
            <h2 id="defense-pool-heading" style="color: #ffaaaa; font-size: 1.2em; margin: 0;">DEFENSE POOL
                <span style="font-size: 0.7em; color: var(--accent-color); font-weight: normal;"> (Auto)</span>
            </h2>
            <div class="defense-value" aria-label="Defense Pool Current and Maximum">
                <span id="defense-rating-current">0</span> / <span id="defense-rating-max">0</span>
            </div>

            <!-- Spend/Reset Buttons -->
            <div style="display: flex; gap: 5px; margin-top: 8px;">
                <button onclick="spendDefensePoint(1)"
                    style="flex: 1; padding: 4px 8px; background: var(--error); border: none; border-radius: 3px; cursor: pointer; font-size: 0.85em;">
                    Spend 1
                </button>
                <button onclick="resetDefensePool()"
                    style="flex: 1; padding: 4px 8px; background: var(--success); border: none; border-radius: 3px; cursor: pointer; font-size: 0.85em;">
                    Reset
                </button>
            </div>

            <p style="color: #aaa; margin: 8px 0 0 0; font-size: 0.85em;">
                Spend points to negate hits or reduce damage.
            </p>

            <!-- Visual Adequacy Indicator -->
            <div style="margin-top: 10px;">
                <div style="background: rgba(50,50,50,0.5); height: 20px; border-radius: 10px; overflow: hidden;">
                    <div id="defense-adequacy-bar"
                        style="height: 100%; background: var(--error); width: 0%; transition: width 0.3s, background 0.3s;">
                    </div>
                </div>
                <div id="defense-status"
                    style="font-size: 0.8em; margin-top: 4px; text-align: center; color: var(--error);">
                    No defenses
                </div>
            </div>

            <!-- Defense Recommendation -->
            <div id="defense-recommendation"
                style="margin-top: 10px; padding: 8px; background: rgba(100,100,150,0.2); border-radius: 4px; font-size: 0.8em; text-align: center;">
                Build defenses to protect your colony
            </div>

            <!-- Defense Breakdown -->
            <div style="margin-top: 8px; font-size: 0.75em; color: #888; border-top: 1px solid #444; padding-top: 5px;">
                <span id="defense-breakdown">No defenses built</span>
            </div>
        </section>

        <!-- Resources -->
        <section class="panel" style="grid-column: span 12;" aria-labelledby="resources-heading">
            <h2 id="resources-heading">Resources</h2>
            <div class="resource-grid">
                <div class="resource-box">
                    <label for="resource-food">Food</label>
                    <input type="number" id="resource-food" name="resource-food" value="50" min="0"
                        aria-label="Food Quantity">
                    <span style="font-size: 0.8em; color: #888;" role="note">Days: 5</span>
                </div>
                <div class="resource-box">
                    <label for="resource-textiles">Textiles</label>
                    <input type="number" id="resource-textiles" name="resource-textiles" value="20" min="0"
                        aria-label="Textiles Quantity">
                </div>
                <div class="resource-box">
                    <label for="resource-ore">Ore</label>
                    <input type="number" id="resource-ore" name="resource-ore" value="100" min="0"
                        aria-label="Ore Quantity">
                </div>
                <div class="resource-box">
                    <label for="resource-components">Components</label>
                    <input type="number" id="resource-components" name="resource-components" value="5" min="0"
                        aria-label="Components Quantity">
                </div>
                <div class="resource-box">
                    <label for="resource-medicine">Medicine</label>
                    <input type="number" id="resource-medicine" name="resource-medicine" value="10" min="0"
                        aria-label="Medicine Quantity">
                </div>
            </div>
        </section>

        <!-- Facilities -->
        <section class="panel" style="grid-column: span 8;" aria-labelledby="facilities-heading">
            <h2 id="facilities-heading">Facilities Grid</h2>
            <div class="facility-grid" role="list" aria-label="Colony Facilities">
                <div class="facility" role="listitem">Barracks (Wood)</div>
                <div class="facility" role="listitem">Kitchen (Steel)</div>
                <div class="facility" role="listitem">Freezer</div>
                <div class="facility" role="listitem">Workshop</div>
                <div class="facility" role="listitem">Hospital</div>
                <div class="facility" role="listitem" style="border-style: dashed; color: #666;">Empty Plot</div>
                <div class="facility" role="listitem" style="border-style: dashed; color: #666;">Empty Plot</div>
                <div class="facility" role="listitem" style="border-style: dashed; color: #666;">Empty Plot</div>
            </div>
            <h3 id="defensive-line-heading">Defensive Line</h3>
            <div class="facility-grid" role="list" aria-labelledby="defensive-line-heading">
                <div class="facility" role="listitem" style="border-color: var(--danger);">Mini-Turret</div>
                <div class="facility" role="listitem" style="border-color: var(--danger);">Sandbags</div>
                <div class="facility" role="listitem" style="border-color: var(--danger);">Sandbags</div>
                <div class="facility" role="listitem" style="border-color: var(--danger);">Spike Trap</div>
            </div>
        </section>

        <!-- Active Projects -->
        <section class="panel" style="grid-column: span 4;" aria-labelledby="construction-queue-heading">
            <h2 id="construction-queue-heading">Construction Queue</h2>

            <article class="active-project" aria-labelledby="proj1-name">
                <div style="display: flex; justify-content: space-between;">
                    <strong id="proj1-name">Killbox Walls</strong>
                    <span id="proj1-label" aria-live="polite" aria-label="Construction Progress">60/100 CP</span>
                </div>
                <div class="bar-container" id="proj1-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0"
                    aria-valuemax="100">
                    <div class="bar-fill" style="width: 60%; background: var(--warning);"></div>
                </div>
                <div class="project-controls" role="group" aria-label="Add Construction Points">
                    <button onclick="addCP('proj1', 1)" aria-label="Add 1 Construction Point">+1 CP</button>
                    <button onclick="addCP('proj1', 5)" aria-label="Add 5 Construction Points">+5 CP</button>
                    <button onclick="addCP('proj1', 10)" aria-label="Add 10 Construction Points">+10 CP</button>
                </div>
            </article>

            <article class="active-project" aria-labelledby="proj2-name">
                <div style="display: flex; justify-content: space-between;">
                    <strong id="proj2-name">Solar Panel</strong>
                    <span id="proj2-label" aria-live="polite" aria-label="Construction Progress">0/200 CP</span>
                </div>
                <div class="bar-container" id="proj2-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0"
                    aria-valuemax="200">
                    <div class="bar-fill" style="width: 0%; background: var(--warning);"></div>
                </div>
                <div class="project-controls" role="group" aria-label="Add Construction Points">
                    <button onclick="addCP('proj2', 5)" aria-label="Add 5 Construction Points">+5 CP</button>
                    <button onclick="addCP('proj2', 20)" aria-label="Add 20 Construction Points">+20 CP</button>
                </div>
            </article>

        </section>

    </div>
</body>

</html>